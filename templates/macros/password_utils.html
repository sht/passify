{% macro strength_indicator(password) %}
<div class="mt-3">
    <div class="d-flex justify-content-between mb-1">
        <span>Password Strength:</span>
        <span id="strengthLabel" class="fw-bold"></span>
    </div>
    <div class="progress">
        <div id="strengthBar" class="progress-bar" role="progressbar"></div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    calculateStrength("{{ password }}");
});

function calculateStrength(password) {
    // Base score
    let strength = 0;
    let label = "";
    let color = "";

    // Length check
    if (password.length >= 12) strength += 25;
    else if (password.length >= 8) strength += 15;
    else strength += 5;

    // Character type checks
    if (/[A-Z]/.test(password)) strength += 15;
    if (/[a-z]/.test(password)) strength += 15;
    if (/[0-9]/.test(password)) strength += 15;
    if (/[^A-Za-z0-9]/.test(password)) strength += 20;

    // Variety check
    const uniqueChars = new Set(password).size;
    const uniqueRatio = uniqueChars / password.length;
    strength += Math.floor(uniqueRatio * 10);

    // Cap at 100%
    strength = Math.min(100, strength);

    // Set label and color based on strength
    if (strength >= 80) {
        label = "Very Strong";
        color = "#28a745"; // green
    } else if (strength >= 60) {
        label = "Strong";
        color = "#17a2b8"; // teal
    } else if (strength >= 40) {
        label = "Medium";
        color = "#ffc107"; // yellow
    } else if (strength >= 20) {
        label = "Weak";
        color = "#fd7e14"; // orange
    } else {
        label = "Very Weak";
        color = "#dc3545"; // red
    }

    // Update UI
    document.getElementById('strengthBar').style.width = strength + '%';
    document.getElementById('strengthBar').style.backgroundColor = color;
    document.getElementById('strengthLabel').textContent = label;
    document.getElementById('strengthLabel').style.color = color;
}
</script>
{% endmacro %}

{% macro password_display(password) %}
<div class="alert alert-success mt-4">
    <div class="d-flex justify-content-between align-items-center mb-2">
        <strong><i class="fas fa-check-circle me-2"></i>Your Password:</strong>
        <button class="btn btn-sm btn-outline-success" id="copyBtn" onclick="copyPassword()">
            <i class="fas fa-copy me-1"></i>Copy
        </button>
    </div>
    <div class="display-6 text-center py-2 font-monospace" id="passwordDisplay">{{ password }}</div>
    
    {{ strength_indicator(password) }}
</div>

<script>
function copyPassword() {
    const passwordText = document.getElementById('passwordDisplay').textContent;
    navigator.clipboard.writeText(passwordText).then(function() {
        const copyBtn = document.getElementById('copyBtn');
        const originalText = copyBtn.innerHTML;

        copyBtn.innerHTML = '<i class="fas fa-check me-1"></i>Copied!';
        copyBtn.classList.remove('btn-outline-success');
        copyBtn.classList.add('btn-success');

        setTimeout(function() {
            copyBtn.innerHTML = originalText;
            copyBtn.classList.remove('btn-success');
            copyBtn.classList.add('btn-outline-success');
        }, 2000);
    });
}
</script>
{% endmacro %}